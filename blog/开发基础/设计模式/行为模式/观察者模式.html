<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>观察者模式 | 一名PHP+GO工程师</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b3aba94c.css" as="style"><link rel="preload" href="/blog/assets/js/app.4c58f1db.js" as="script"><link rel="preload" href="/blog/assets/js/3.a4fcd0ee.js" as="script"><link rel="preload" href="/blog/assets/js/49.49e438b2.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.835fec01.js"><link rel="prefetch" href="/blog/assets/js/100.dc00317a.js"><link rel="prefetch" href="/blog/assets/js/101.7eebede9.js"><link rel="prefetch" href="/blog/assets/js/102.82f3c447.js"><link rel="prefetch" href="/blog/assets/js/103.eab9003e.js"><link rel="prefetch" href="/blog/assets/js/104.10bc5a69.js"><link rel="prefetch" href="/blog/assets/js/105.4ab84c31.js"><link rel="prefetch" href="/blog/assets/js/106.48a2438e.js"><link rel="prefetch" href="/blog/assets/js/107.cc68b4a0.js"><link rel="prefetch" href="/blog/assets/js/108.a8d052c3.js"><link rel="prefetch" href="/blog/assets/js/109.2cc1bd1b.js"><link rel="prefetch" href="/blog/assets/js/11.2975610c.js"><link rel="prefetch" href="/blog/assets/js/110.8f8186a2.js"><link rel="prefetch" href="/blog/assets/js/111.eaf08c2f.js"><link rel="prefetch" href="/blog/assets/js/112.c4fa3638.js"><link rel="prefetch" href="/blog/assets/js/113.2b4447c9.js"><link rel="prefetch" href="/blog/assets/js/114.04ffca65.js"><link rel="prefetch" href="/blog/assets/js/115.e5496f96.js"><link rel="prefetch" href="/blog/assets/js/116.4a8c606f.js"><link rel="prefetch" href="/blog/assets/js/117.037382b2.js"><link rel="prefetch" href="/blog/assets/js/118.5bb91c57.js"><link rel="prefetch" href="/blog/assets/js/119.09db3f3b.js"><link rel="prefetch" href="/blog/assets/js/12.a764b57a.js"><link rel="prefetch" href="/blog/assets/js/120.b24a6d4e.js"><link rel="prefetch" href="/blog/assets/js/121.ca19b1f3.js"><link rel="prefetch" href="/blog/assets/js/122.561ef8e8.js"><link rel="prefetch" href="/blog/assets/js/123.f0e374e2.js"><link rel="prefetch" href="/blog/assets/js/124.e9989260.js"><link rel="prefetch" href="/blog/assets/js/125.b0f30b2f.js"><link rel="prefetch" href="/blog/assets/js/126.1a1939b5.js"><link rel="prefetch" href="/blog/assets/js/127.e2142582.js"><link rel="prefetch" href="/blog/assets/js/128.a6a813a1.js"><link rel="prefetch" href="/blog/assets/js/129.bf107fcf.js"><link rel="prefetch" href="/blog/assets/js/13.3adc8648.js"><link rel="prefetch" href="/blog/assets/js/130.130b9782.js"><link rel="prefetch" href="/blog/assets/js/131.b153558f.js"><link rel="prefetch" href="/blog/assets/js/132.2472d0a5.js"><link rel="prefetch" href="/blog/assets/js/133.549915cc.js"><link rel="prefetch" href="/blog/assets/js/134.5b06b412.js"><link rel="prefetch" href="/blog/assets/js/135.95e51dda.js"><link rel="prefetch" href="/blog/assets/js/136.1d13c0e3.js"><link rel="prefetch" href="/blog/assets/js/137.a6b4615c.js"><link rel="prefetch" href="/blog/assets/js/138.738cf96b.js"><link rel="prefetch" href="/blog/assets/js/139.d897ac9a.js"><link rel="prefetch" href="/blog/assets/js/14.a3b148c6.js"><link rel="prefetch" href="/blog/assets/js/140.270aba65.js"><link rel="prefetch" href="/blog/assets/js/141.e1f2d4d3.js"><link rel="prefetch" href="/blog/assets/js/142.2ff02945.js"><link rel="prefetch" href="/blog/assets/js/143.c72c097b.js"><link rel="prefetch" href="/blog/assets/js/144.dc000941.js"><link rel="prefetch" href="/blog/assets/js/145.c82275d5.js"><link rel="prefetch" href="/blog/assets/js/146.4aebd6b1.js"><link rel="prefetch" href="/blog/assets/js/147.0287686c.js"><link rel="prefetch" href="/blog/assets/js/148.b0bca954.js"><link rel="prefetch" href="/blog/assets/js/149.15a2e786.js"><link rel="prefetch" href="/blog/assets/js/15.6bfd2036.js"><link rel="prefetch" href="/blog/assets/js/150.2cfeb60d.js"><link rel="prefetch" href="/blog/assets/js/151.c359177f.js"><link rel="prefetch" href="/blog/assets/js/152.19a86bd8.js"><link rel="prefetch" href="/blog/assets/js/153.4159b600.js"><link rel="prefetch" href="/blog/assets/js/154.121f5cc3.js"><link rel="prefetch" href="/blog/assets/js/155.97708bc3.js"><link rel="prefetch" href="/blog/assets/js/156.f9c6bcdd.js"><link rel="prefetch" href="/blog/assets/js/157.6755fc50.js"><link rel="prefetch" href="/blog/assets/js/158.479651f6.js"><link rel="prefetch" href="/blog/assets/js/159.031af42e.js"><link rel="prefetch" href="/blog/assets/js/16.62be6808.js"><link rel="prefetch" href="/blog/assets/js/160.ec9dd64d.js"><link rel="prefetch" href="/blog/assets/js/161.bc8dd162.js"><link rel="prefetch" href="/blog/assets/js/162.2b87186a.js"><link rel="prefetch" href="/blog/assets/js/163.5efb49e5.js"><link rel="prefetch" href="/blog/assets/js/164.7b79d6e9.js"><link rel="prefetch" href="/blog/assets/js/165.c0887522.js"><link rel="prefetch" href="/blog/assets/js/166.59b3fd1e.js"><link rel="prefetch" href="/blog/assets/js/167.3350e62a.js"><link rel="prefetch" href="/blog/assets/js/168.305d6c4c.js"><link rel="prefetch" href="/blog/assets/js/169.1e7bb107.js"><link rel="prefetch" href="/blog/assets/js/17.380ba58f.js"><link rel="prefetch" href="/blog/assets/js/170.a5ef964f.js"><link rel="prefetch" href="/blog/assets/js/171.c65fb717.js"><link rel="prefetch" href="/blog/assets/js/172.449d2311.js"><link rel="prefetch" href="/blog/assets/js/173.83f97e48.js"><link rel="prefetch" href="/blog/assets/js/174.3eca4f09.js"><link rel="prefetch" href="/blog/assets/js/175.9fc6896e.js"><link rel="prefetch" href="/blog/assets/js/176.2036b264.js"><link rel="prefetch" href="/blog/assets/js/177.5b0117fa.js"><link rel="prefetch" href="/blog/assets/js/178.65b256f2.js"><link rel="prefetch" href="/blog/assets/js/179.f26bcc6c.js"><link rel="prefetch" href="/blog/assets/js/18.5cc6f3a7.js"><link rel="prefetch" href="/blog/assets/js/180.0f225157.js"><link rel="prefetch" href="/blog/assets/js/181.680ac14a.js"><link rel="prefetch" href="/blog/assets/js/182.3edee8c1.js"><link rel="prefetch" href="/blog/assets/js/183.2ad4dd90.js"><link rel="prefetch" href="/blog/assets/js/19.a5c2b897.js"><link rel="prefetch" href="/blog/assets/js/2.c8a68b51.js"><link rel="prefetch" href="/blog/assets/js/20.dba1906e.js"><link rel="prefetch" href="/blog/assets/js/21.eb95247a.js"><link rel="prefetch" href="/blog/assets/js/22.0dc20366.js"><link rel="prefetch" href="/blog/assets/js/23.216a8421.js"><link rel="prefetch" href="/blog/assets/js/24.2710df9d.js"><link rel="prefetch" href="/blog/assets/js/25.a628a83e.js"><link rel="prefetch" href="/blog/assets/js/26.c8cc9490.js"><link rel="prefetch" href="/blog/assets/js/27.b6aa595b.js"><link rel="prefetch" href="/blog/assets/js/28.e9bc0181.js"><link rel="prefetch" href="/blog/assets/js/29.dd1ae43d.js"><link rel="prefetch" href="/blog/assets/js/30.d695ccf7.js"><link rel="prefetch" href="/blog/assets/js/31.32df4d02.js"><link rel="prefetch" href="/blog/assets/js/32.0fffbc5f.js"><link rel="prefetch" href="/blog/assets/js/33.6b3bbf30.js"><link rel="prefetch" href="/blog/assets/js/34.b4c3eaa1.js"><link rel="prefetch" href="/blog/assets/js/35.76a8a203.js"><link rel="prefetch" href="/blog/assets/js/36.4d6733d9.js"><link rel="prefetch" href="/blog/assets/js/37.95ddd62d.js"><link rel="prefetch" href="/blog/assets/js/38.d92a014e.js"><link rel="prefetch" href="/blog/assets/js/39.c6e76213.js"><link rel="prefetch" href="/blog/assets/js/4.e9a98dae.js"><link rel="prefetch" href="/blog/assets/js/40.8c0ce826.js"><link rel="prefetch" href="/blog/assets/js/41.33b0fa25.js"><link rel="prefetch" href="/blog/assets/js/42.96f29d4d.js"><link rel="prefetch" href="/blog/assets/js/43.4ed5ff9c.js"><link rel="prefetch" href="/blog/assets/js/44.77353d4f.js"><link rel="prefetch" href="/blog/assets/js/45.ab5daeac.js"><link rel="prefetch" href="/blog/assets/js/46.8adfc6dd.js"><link rel="prefetch" href="/blog/assets/js/47.2ae15dfc.js"><link rel="prefetch" href="/blog/assets/js/48.31ba75e5.js"><link rel="prefetch" href="/blog/assets/js/5.5ec4d71f.js"><link rel="prefetch" href="/blog/assets/js/50.f8254ac5.js"><link rel="prefetch" href="/blog/assets/js/51.90ad6773.js"><link rel="prefetch" href="/blog/assets/js/52.b5da9d10.js"><link rel="prefetch" href="/blog/assets/js/53.82345eb5.js"><link rel="prefetch" href="/blog/assets/js/54.f93a6f8d.js"><link rel="prefetch" href="/blog/assets/js/55.dd6d8ef8.js"><link rel="prefetch" href="/blog/assets/js/56.63add859.js"><link rel="prefetch" href="/blog/assets/js/57.bd76cf23.js"><link rel="prefetch" href="/blog/assets/js/58.25135cb4.js"><link rel="prefetch" href="/blog/assets/js/59.ecd67516.js"><link rel="prefetch" href="/blog/assets/js/6.84e1b999.js"><link rel="prefetch" href="/blog/assets/js/60.23e89841.js"><link rel="prefetch" href="/blog/assets/js/61.68d9cb1f.js"><link rel="prefetch" href="/blog/assets/js/62.d1b8d952.js"><link rel="prefetch" href="/blog/assets/js/63.1d640eca.js"><link rel="prefetch" href="/blog/assets/js/64.32167475.js"><link rel="prefetch" href="/blog/assets/js/65.f7a24ac5.js"><link rel="prefetch" href="/blog/assets/js/66.5a4ad07b.js"><link rel="prefetch" href="/blog/assets/js/67.5abe04b4.js"><link rel="prefetch" href="/blog/assets/js/68.4bd07a6f.js"><link rel="prefetch" href="/blog/assets/js/69.61cefde7.js"><link rel="prefetch" href="/blog/assets/js/7.be512878.js"><link rel="prefetch" href="/blog/assets/js/70.d884d460.js"><link rel="prefetch" href="/blog/assets/js/71.6346d932.js"><link rel="prefetch" href="/blog/assets/js/72.669b09d5.js"><link rel="prefetch" href="/blog/assets/js/73.c1d8c39c.js"><link rel="prefetch" href="/blog/assets/js/74.36016cfd.js"><link rel="prefetch" href="/blog/assets/js/75.fb7d7a96.js"><link rel="prefetch" href="/blog/assets/js/76.ba71ac91.js"><link rel="prefetch" href="/blog/assets/js/77.651eea09.js"><link rel="prefetch" href="/blog/assets/js/78.9993efdc.js"><link rel="prefetch" href="/blog/assets/js/79.816d277e.js"><link rel="prefetch" href="/blog/assets/js/8.93ccc70d.js"><link rel="prefetch" href="/blog/assets/js/80.e39860ed.js"><link rel="prefetch" href="/blog/assets/js/81.77799baa.js"><link rel="prefetch" href="/blog/assets/js/82.9b8b2e5c.js"><link rel="prefetch" href="/blog/assets/js/83.1ae8f42d.js"><link rel="prefetch" href="/blog/assets/js/84.ffb238f7.js"><link rel="prefetch" href="/blog/assets/js/85.238317c1.js"><link rel="prefetch" href="/blog/assets/js/86.badce18f.js"><link rel="prefetch" href="/blog/assets/js/87.bf03f5f0.js"><link rel="prefetch" href="/blog/assets/js/88.817f8a13.js"><link rel="prefetch" href="/blog/assets/js/89.3b6fc0d2.js"><link rel="prefetch" href="/blog/assets/js/9.aba0f006.js"><link rel="prefetch" href="/blog/assets/js/90.c08fced7.js"><link rel="prefetch" href="/blog/assets/js/91.247d2df4.js"><link rel="prefetch" href="/blog/assets/js/92.8b0a6fda.js"><link rel="prefetch" href="/blog/assets/js/93.be593c08.js"><link rel="prefetch" href="/blog/assets/js/94.27fd5c80.js"><link rel="prefetch" href="/blog/assets/js/95.021cdc5a.js"><link rel="prefetch" href="/blog/assets/js/96.e1d5c9c7.js"><link rel="prefetch" href="/blog/assets/js/97.b3e60c1f.js"><link rel="prefetch" href="/blog/assets/js/98.73459e19.js"><link rel="prefetch" href="/blog/assets/js/99.737e92f6.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b3aba94c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一名PHP+GO工程师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/开发基础/设计模式/创建型模式/单例模式" class="sidebar-heading clickable"><span>创建型模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/开发基础/设计模式/创建型模式/单例模式.html" class="sidebar-link">单例模式</a></li><li><a href="/blog/开发基础/设计模式/创建型模式/原型模式.html" class="sidebar-link">原型模式</a></li><li><a href="/blog/开发基础/设计模式/创建型模式/工厂方法模式.html" class="sidebar-link">工厂方法模式</a></li><li><a href="/blog/开发基础/设计模式/创建型模式/抽象工厂模式.html" class="sidebar-link">抽象工厂模式</a></li><li><a href="/blog/开发基础/设计模式/创建型模式/生成器模式.html" class="sidebar-link">生成器模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/开发基础/设计模式/结构型模式/享元模式" class="sidebar-heading clickable"><span>结构型模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/开发基础/设计模式/结构型模式/享元模式.html" class="sidebar-link">享元模式</a></li><li><a href="/blog/开发基础/设计模式/结构型模式/代理模式.html" class="sidebar-link">代理模式</a></li><li><a href="/blog/开发基础/设计模式/结构型模式/外观模式.html" class="sidebar-link">外观模式</a></li><li><a href="/blog/开发基础/设计模式/结构型模式/桥接模式.html" class="sidebar-link">桥接模式</a></li><li><a href="/blog/开发基础/设计模式/结构型模式/组合模式.html" class="sidebar-link">组合模式</a></li><li><a href="/blog/开发基础/设计模式/结构型模式/装饰模式.html" class="sidebar-link">装饰模式</a></li><li><a href="/blog/开发基础/设计模式/结构型模式/适配器模式.html" class="sidebar-link">适配器模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/开发基础/设计模式/行为模式/中介者模式" class="sidebar-heading clickable open"><span>行为模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/开发基础/设计模式/行为模式/中介者模式.html" class="sidebar-link">中介者模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/命令模式.html" class="sidebar-link">命令模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/备忘录模式.html" class="sidebar-link">备忘录模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/模板方法模式.html" class="sidebar-link">模板方法模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/状态模式.html" class="sidebar-link">状态模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/策略模式.html" class="sidebar-link">策略模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/观察者模式.html" class="active sidebar-link">观察者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/开发基础/设计模式/行为模式/观察者模式.html#意图" class="sidebar-link">意图</a></li><li class="sidebar-sub-header"><a href="/blog/开发基础/设计模式/行为模式/观察者模式.html#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/blog/开发基础/设计模式/行为模式/观察者模式.html#解决方案" class="sidebar-link">解决方案</a></li><li class="sidebar-sub-header"><a href="/blog/开发基础/设计模式/行为模式/观察者模式.html#真实世界类比" class="sidebar-link">真实世界类比</a></li><li class="sidebar-sub-header"><a href="/blog/开发基础/设计模式/行为模式/观察者模式.html#概念示例" class="sidebar-link">概念示例</a></li></ul></li><li><a href="/blog/开发基础/设计模式/行为模式/访问者模式.html" class="sidebar-link">访问者模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/责任链模式.html" class="sidebar-link">责任链模式</a></li><li><a href="/blog/开发基础/设计模式/行为模式/迭代器模式.html" class="sidebar-link">迭代器模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h1> <h2 id="意图"><a href="#意图" class="header-anchor">#</a> 意图</h2> <p><strong>观察者模式</strong>是一种行为设计模式， 允许你定义一种订阅机制， 可在对象事件发生时通知多个 “观察” 该对象的其他对象。</p> <p><img src="/blog/assets/img/observer.d66f5921.png" alt="观察者设计模式"></p> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <p>假如你有两种类型的对象：  <code>顾客</code>和 <code>商店</code> 。 顾客对某个特定品牌的产品非常感兴趣 （例如最新型号的 iPhone 手机）， 而该产品很快将会在商店里出售。</p> <p>顾客可以每天来商店看看产品是否到货。 但如果商品尚未到货时， 绝大多数来到商店的顾客都会空手而归。</p> <p><img src="/blog/assets/img/observer-comic-1-zh.feeeb969.png" alt="访问商店或发送垃圾邮件"></p> <p>前往商店和发送垃圾邮件</p> <p>另一方面， 每次新产品到货时， 商店可以向所有顾客发送邮件 （可能会被视为垃圾邮件）。 这样， 部分顾客就无需反复前往商店了， 但也可能会惹恼对新产品没有兴趣的其他顾客。</p> <p>我们似乎遇到了一个矛盾： 要么让顾客浪费时间检查产品是否到货， 要么让商店浪费资源去通知没有需求的顾客。</p> <h2 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h2> <p>拥有一些值得关注的状态的对象通常被称为<em>目标</em>， 由于它要将自身的状态改变通知给其他对象， 我们也将其称为<em>发布者</em> （publisher）。 所有希望关注发布者状态变化的其他对象被称为<em>订阅者</em> （subscribers）。</p> <p>观察者模式建议你为发布者类添加订阅机制， 让每个对象都能订阅或取消订阅发布者事件流。 不要害怕！ 这并不像听上去那么复杂。 实际上， 该机制包括 1） 一个用于存储订阅者对象引用的列表成员变量； 2） 几个用于添加或删除该列表中订阅者的公有方法。</p> <p><img src="data:image/png;base64,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" alt="订阅机制"></p> <p>订阅机制允许对象订阅事件通知。</p> <p>现在， 无论何时发生了重要的发布者事件， 它都要遍历订阅者并调用其对象的特定通知方法。</p> <p>实际应用中可能会有十几个不同的订阅者类跟踪着同一个发布者类的事件， 你不会希望发布者与所有这些类相耦合的。 此外如果他人会使用发布者类， 那么你甚至可能会对其中的一些类一无所知。</p> <p>因此， 所有订阅者都必须实现同样的接口， 发布者仅通过该接口与订阅者交互。 接口中必须声明通知方法及其参数， 这样发布者在发出通知时还能传递一些上下文数据。</p> <p><img src="/blog/assets/img/solution2-zh.9283a54c.png" alt="通知方法"></p> <p>发布者调用订阅者对象中的特定通知方法来通知订阅者。</p> <p>如果你的应用中有多个不同类型的发布者， 且希望订阅者可兼容所有发布者， 那么你甚至可以进一步让所有订阅者遵循同样的接口。 该接口仅需描述几个订阅方法即可。 这样订阅者就能在不与具体发布者类耦合的情况下通过接口观察发布者的状态。</p> <h2 id="真实世界类比"><a href="#真实世界类比" class="header-anchor">#</a> 真实世界类比</h2> <p><img src="/blog/assets/img/observer-comic-2-zh.bd9d9cf4.png" alt="杂志和报纸订阅"></p> <p>杂志和报纸订阅。</p> <p>如果你订阅了一份杂志或报纸， 那就不需要再去报摊查询新出版的刊物了。 出版社 （即应用中的 “发布者”） 会在刊物出版后 （甚至提前） 直接将最新一期寄送至你的邮箱中。</p> <p>出版社负责维护订阅者列表， 了解订阅者对哪些刊物感兴趣。 当订阅者希望出版社停止寄送新一期的杂志时， 他们可随时从该列表中退出。</p> <h1 id="go-观察者模式讲解和代码示例"><a href="#go-观察者模式讲解和代码示例" class="header-anchor">#</a> Go <strong>观察者</strong>模式讲解和代码示例</h1> <p><strong>观察者</strong>是一种行为设计模式， 允许一个对象将其状态的改变通知其他对象</p> <p>观察者模式提供了一种作用于任何实现了订阅者接口的对象的机制， 可对其事件进行订阅和取消订阅。</p> <h2 id="概念示例"><a href="#概念示例" class="header-anchor">#</a> 概念示例</h2> <p>在电商网站中， 商品时不时地会出现缺货情况。 可能会有客户对于缺货的特定商品表现出兴趣。 这一问题有三种解决方案：</p> <ol><li>客户以一定的频率查看商品的可用性。</li> <li>电商网站向客户发送有库存的所有新商品。</li> <li>客户只订阅其感兴趣的特定商品， 商品可用时便会收到通知。 同时， 多名客户也可订阅同一款产品。</li></ol> <p>选项 3 是最具可行性的， 这其实就是观察者模式的思想。 观察者模式的主要组成部分有：</p> <ul><li>会在有任何事发生时发布事件的主体。</li> <li>订阅了主体事件并会在事件发生时收到通知的观察者。</li></ul> <h4 id="subject-go-主体"><a href="#subject-go-主体" class="header-anchor">#</a> <strong>subject.go:</strong> 主体</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">type</span> subject <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">register</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>
    <span class="token function">deregister</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>
    <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="item-go-具体主体"><a href="#item-go-具体主体" class="header-anchor">#</a> <strong>item.go:</strong> 具体主体</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">type</span> item <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    observerList <span class="token punctuation">[</span><span class="token punctuation">]</span>observer
    name         <span class="token builtin">string</span>
    inStock      <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newItem</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>item <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>item<span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>item<span class="token punctuation">)</span> <span class="token function">updateAvailability</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Item %s is now in stock\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    i<span class="token punctuation">.</span>inStock <span class="token operator">=</span> <span class="token boolean">true</span>
    i<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>item<span class="token punctuation">)</span> <span class="token function">register</span><span class="token punctuation">(</span>o observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i<span class="token punctuation">.</span>observerList <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>observerList<span class="token punctuation">,</span> o<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>item<span class="token punctuation">)</span> <span class="token function">deregister</span><span class="token punctuation">(</span>o observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i<span class="token punctuation">.</span>observerList <span class="token operator">=</span> <span class="token function">removeFromslice</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>observerList<span class="token punctuation">,</span> o<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>item<span class="token punctuation">)</span> <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> observer <span class="token operator">:=</span> <span class="token keyword">range</span> i<span class="token punctuation">.</span>observerList <span class="token punctuation">{</span>
        observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">removeFromslice</span><span class="token punctuation">(</span>observerList <span class="token punctuation">[</span><span class="token punctuation">]</span>observer<span class="token punctuation">,</span> observerToRemove observer<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>observer <span class="token punctuation">{</span>
    observerListLength <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>observerList<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> observer <span class="token operator">:=</span> <span class="token keyword">range</span> observerList <span class="token punctuation">{</span>
        <span class="token keyword">if</span> observerToRemove<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> observer<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            observerList<span class="token punctuation">[</span>observerListLength<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> observerList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> observerList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> observerList<span class="token punctuation">[</span>observerListLength<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">return</span> observerList<span class="token punctuation">[</span><span class="token punctuation">:</span>observerListLength<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> observerList
<span class="token punctuation">}</span>
</code></pre></div><h4 id="observer-go-观察者"><a href="#observer-go-观察者" class="header-anchor">#</a> <strong>observer.go:</strong> 观察者</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">type</span> observer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
    <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="customer-go-具体观察者"><a href="#customer-go-具体观察者" class="header-anchor">#</a> <strong>customer.go:</strong> 具体观察者</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">type</span> customer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    id <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>customer<span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>itemName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Sending email to customer %s for item %s\n&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> itemName<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>customer<span class="token punctuation">)</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> c<span class="token punctuation">.</span>id
<span class="token punctuation">}</span>
</code></pre></div><h4 id="main-go-客户端代码"><a href="#main-go-客户端代码" class="header-anchor">#</a> <strong>main.go:</strong> 客户端代码</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    shirtItem <span class="token operator">:=</span> <span class="token function">newItem</span><span class="token punctuation">(</span><span class="token string">&quot;Nike Shirt&quot;</span><span class="token punctuation">)</span>

    observerFirst <span class="token operator">:=</span> <span class="token operator">&amp;</span>customer<span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token string">&quot;abc@gmail.com&quot;</span><span class="token punctuation">}</span>
    observerSecond <span class="token operator">:=</span> <span class="token operator">&amp;</span>customer<span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token string">&quot;xyz@gmail.com&quot;</span><span class="token punctuation">}</span>

    shirtItem<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>observerFirst<span class="token punctuation">)</span>
    shirtItem<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>observerSecond<span class="token punctuation">)</span>

    shirtItem<span class="token punctuation">.</span><span class="token function">updateAvailability</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="output-txt-执行结果"><a href="#output-txt-执行结果" class="header-anchor">#</a> <strong>output.txt:</strong> 执行结果</h4> <div class="language- extra-class"><pre class="language-text"><code>Item Nike Shirt is now in stock
Sending email to customer abc@gmail.com for item Nike Shirt
Sending email to customer xyz@gmail.com for item Nike Shirt
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/21/2021, 1:25:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/开发基础/设计模式/行为模式/策略模式.html" class="prev">
        策略模式
      </a></span> <span class="next"><a href="/blog/开发基础/设计模式/行为模式/访问者模式.html">
        访问者模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.4c58f1db.js" defer></script><script src="/blog/assets/js/3.a4fcd0ee.js" defer></script><script src="/blog/assets/js/49.49e438b2.js" defer></script>
  </body>
</html>
